document.addEventListener("DOMContentLoaded",inicio());let map,edificiosJSON;function inicio(){crearSlider(),null===sessionStorage.getItem("date")&&setCurrentDate(),null===sessionStorage.getItem("i")&&sessionStorage.setItem("i","0"),leerJSONEdificios().then(()=>{crearSeccionPortfolio()}),getUserPosition(),setNavPorfolioHidden(!1),crearSeccionTeam();let e=new Date(sessionStorage.getItem("date"));document.getElementById("Copyright").innerHTML="Copyright &copy; Mallorca Route "+e.getFullYear();let t=document.getElementById("logoMashorca"),i=document.getElementById("inicio");t.onclick=goHome,i.onclick=goHome,scriptSlider()}async function leerJSONEdificios(){try{let e=["edificios.json","https://www.descobreixteatre.com/assets/json/Teatre.json"],t=[],i=[];for(let a=0;a<e.length;a++)t[a]=await fetch(e[a]),i[a]=await t[a].json();edificiosJSON=[],getEdificiosObjJson(i[0]),getEventosTeatroObjJson(i[1])}catch(l){console.error("Error al cargar el archivo JSON:",l)}}function getEdificiosObjJson(e){e.itemListElement.forEach(function(e){let t={nombre:e.name,subtitulo:e.description.alternativeHeadline,descripcion:e.description.description,estilo:e.description.genre,horario:convertirHorariosJson(e.openingHours),imagen:e.image,video:e.subjectOf.video,audio:e.subjectOf.audio,lat:e.geo.latitude,lon:e.geo.longitude,url:e.url,likes:e.aggregateRating.ratingCount,isAccessibleForFree:e.isAccessibleForFree,parking:e.parking};edificiosJSON.push(t)})}function getEventosTeatroObjJson(e){let t="https://www.descobreixteatre.com/";e.itemListElement.forEach(function(e){if("Mallorca"===e.address.addressRegion){let i=e.geo.latitude,a=e.geo.longitude,l=e.name,n=e.address.addressLocality;e.event.forEach(function(d){let r={nombre:d.name+" ("+n+")",subtitulo:l,descripcion:d.description,imagen:t+e.image.contentUrl,video:"",audio:"",lat:i,lon:a,isAccessibleForFree:!1,fecha:d.startDate,parking:!0};d.additionalProperty[0].value&&(r.video=t+d.additionalProperty[0].url),edificiosJSON.push(r)})}})}function convertirHorariosJson(e){let t=["Mo","Tu","We","Th","Fr","Sa","Su"],i=["Lu","Ma","Mi","Ju","Vi","Sa","Do"],a=[];if(void 0!==e)return e.forEach(function(e){let l=e.split(" ")[0].split("-"),n=e.split(" ")[1].split("-"),d=t.indexOf(l[0]),r=t.indexOf(l[l.length-1]);d>r&&(r+=7);for(let o=0;o<7;o++){let s=i[o];o>=d&&o<=r&&a.push(`${s}$${n[0]} - ${n[1]}`)}}),a}function setCurrentDate(){let e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");sessionStorage.setItem("date",`${t}-${i}-${a}`)}function setNavPorfolioHidden(e){let t=document.getElementById("portfolioNav");e?t.setAttribute("hidden","true"):t.removeAttribute("hidden")}function crearSeccionPortfolio(){let e=document.getElementById("portfolioContainer"),t=document.createElement("div");t.classList.add("text-center");let i=document.createElement("h2");i.classList.add("section-heading","text-uppercase"),i.textContent="Conoce los lugares m\xe1s emblem\xe1ticos de la isla";let a=document.createElement("h3");a.classList.add("section-subheading","text-muted"),a.textContent="Aprende sobre los atractivos culturales de la isla",t.appendChild(i),t.appendChild(a),e.appendChild(t);let l=document.createElement("div");l.classList.add("row"),e.appendChild(l);let n=0;edificiosJSON.forEach(function(e){if(n<6){let t="";e?.subtitulo!==void 0&&(t=e.subtitulo);let i=`
                <div class="col-lg-4 col-sm-6 mb-4">
                    <div class="portfolio-item">
                        <a class="portfolio-link" data-bs-toggle="modal" href="#portfolioModal${n}">
                            <div class="portfolio-hover">
                                <div class="portfolio-hover-content"><i class="fas fa-plus fa-3x"></i></div>
                            </div>
                            <img class="img-fluid" src="${e.imagen}" alt="..." loading="lazy"/>
                        </a>
                        <div class="portfolio-caption">
                            <div class="portfolio-caption-heading">${e.nombre}</div>
                            <div class="portfolio-caption-subheading text-muted">${t}</div>
                        </div>
                    </div>
                </div>
            `;l.innerHTML+=i,n++}}),generarPopUpsInicio()}function crearSeccionTeam(){let e=document.createElement("section");e.classList.add("page-section","bg-light"),e.id="team";let t=document.createElement("div");t.classList.add("container");let i=document.createElement("div");i.classList.add("text-center");let a=document.createElement("h2");a.classList.add("section-heading","text-uppercase"),a.textContent="Nuestro Equipo";let l=document.createElement("h3");l.classList.add("section-subheading","text-muted"),l.textContent="Trabajando por el inter\xe9s cultural de Mallorca.",i.appendChild(a),i.appendChild(l);let n=document.createElement("div");n.classList.add("row"),[{nombre:"Eduardo Osuna",rol:"Dise\xf1ador Jefe",imagen:"assets/img/team/1.jpg"},{nombre:"Santiago Rattenbach",rol:"Desarrollador Jefe",imagen:"assets/img/team/3.jpg"},{nombre:"Jorge",rol:"Director de Marketing",imagen:"assets/img/team/2.jpg"}].forEach(function(e){let t=`
            <div class="col-lg-4">
                <div class="team-member">
                    <img class="mx-auto rounded-circle" src="${e.imagen}" alt="..." loading="lazy" />
                    <h4>${e.nombre}</h4>
                    <p class="text-muted">${e.rol}</p>
                    <a class="btn btn-dark btn-social mx-2" href="#!" aria-label="${e.nombre} Twitter Profile"><i class="fab fa-twitter"></i></a>
                    <a class="btn btn-dark btn-social mx-2" href="#!" aria-label="${e.nombre} Facebook Profile"><i class="fab fa-facebook-f"></i></a>
                    <a class="btn btn-dark btn-social mx-2" href="#!" aria-label="${e.nombre} LinkedIn Profile"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        `;n.innerHTML+=t});let d=document.createElement("div");d.classList.add("row");let r=document.createElement("div");r.classList.add("col-lg-8","mx-auto","text-center");let o=document.createElement("p");o.classList.add("large","text-muted"),o.textContent="Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aut eaque, laboriosam veritatis, quos non quis ad perspiciatis, totam corporis ea, alias ut unde.",r.appendChild(o),d.appendChild(r),t.appendChild(i),t.appendChild(n),t.appendChild(d),e.appendChild(t);document.getElementById("main").appendChild(e)}function generarPopUpsInicio(){let e=document.getElementById("portfolio-modals"),t=0;edificiosJSON.forEach(function(i){var a;generarPopUp(e,i,t);let l=document.getElementById("hourIn"+t),n=document.getElementById("hourOut"+t);function d(e){let t=document.getElementById("botonAgregar"+e),i=document.getElementById("hourIn"+e),a=document.getElementById("hourOut"+e);i.value&&a.value&&i.value<a.value?t.disabled=!1:t.disabled=!0}a=t,l.addEventListener("change",function(){d(a)}),n.addEventListener("change",function(){d(a)}),d(a),t++})}function generarPopUp(e,t,i){let a=document.createElement("div");a.classList.add("portfolio-modal","modal","fade"),a.id="portfolioModal"+i,a.setAttribute("tabindex","-1"),a.setAttribute("role","dialog"),a.setAttribute("aria-hidden","true");let l=generarContenidoPopUp(t,i);a.appendChild(l),e.appendChild(a)}function generarContenidoPopUp(e,t){let i=document.createElement("div");i.classList.add("modal-dialog","d-flex","justify-content-center");let a=document.createElement("div");a.classList.add("modal-content"),i.appendChild(a);let l=document.createElement("div");l.classList.add("close-modal"),l.setAttribute("data-bs-dismiss","modal");let n=document.createElement("img");n.setAttribute("src","assets/img/close-icon.svg"),n.setAttribute("alt","Close modal"),n.setAttribute("loading","lazy"),l.appendChild(n),a.appendChild(l);let d=document.createElement("div");d.classList.add("container"),a.appendChild(d);let r=document.createElement("div");r.classList.add("row","justify-content-center"),d.appendChild(r);let o=document.createElement("div");o.classList.add("col-lg-8"),r.appendChild(o);let s=generarModalBodyContent(e,t);return o.appendChild(s),i}function generarModalBodyContent(e,t){let i=document.createElement("div");i.setAttribute("id","modalBody"+t),i.classList.add("modal-body");let a=document.createElement("h2");if(a.classList.add("text-uppercase"),a.textContent=e.nombre,i.appendChild(a),e?.subtitulo!==void 0&&""!==e.subtitulo){let l=document.createElement("p");l.classList.add("item-intro","text-muted","mt-2","mb-4"),l.textContent=e.subtitulo+".",i.appendChild(l)}if(e?.video===void 0||e?.video===""){let n=document.createElement("img");n.classList.add("img-fluid","d-block","mx-auto"),n.setAttribute("src",e.imagen),n.setAttribute("alt",e.nombre),i.appendChild(n)}else{let d=document.createElement("video");d.classList.add("img-fluid","d-block","mx-auto"),d.setAttribute("src",e.video),d.setAttribute("alt",e.nombre),d.setAttribute("controls","true"),i.appendChild(d)}if(e?.audio!==void 0&&e?.audio!==""){let r=document.createElement("audio");r.classList.add("d-block","mx-auto","mb-4","mt-2"),r.setAttribute("src",e.audio),r.setAttribute("controls","true"),i.appendChild(r)}if(e?.estilo!==void 0){let o=document.createElement("div");o.classList.add("list-inline-item","mb-3");let s=document.createElement("strong");s.innerHTML="Estilo:",o.appendChild(s),o.innerHTML+=" "+e.estilo,i.appendChild(o)}let c=document.createElement("div");c.classList.add("d-flex","justify-content-center"),i.appendChild(c);let m=document.createElement("button");m.classList.add("btn","btn-primary","mb-4","mt-2","text-center","px-4","py-3","fw-bolder"),m.style.fontFamily="Montserrat",m.setAttribute("data-bs-toggle","collapse"),m.setAttribute("data-bs-target","#descripcion"+t),m.textContent="Descripci\xf3n ↓",c.appendChild(m),m.onclick=function(){m.textContent.includes("↓")?m.textContent="Descripci\xf3n ↑":m.textContent="Descripci\xf3n ↓"};let p=document.createElement("p");p.id="descripcion"+t,p.textContent=e.descripcion,p.classList.add("collapse"),i.appendChild(p);let u=document.createElement("div");u.setAttribute("hidden","true"),u.classList.add("mb-4","listaHorizontal");let f=document.createElement("div");f.setAttribute("id","clima"),f.classList.add("d-flex","justify-content-center");let h=0,g=new Date(sessionStorage.getItem("date")).getDate()-new Date().getDate();if(0===g){h=new Date().getHours();do h++;while(h%3!=0)}for(let b=0;h<24;h+=3,b++){let v;obtenerDatosClima(e.lat,e.lon,h,b+8*g).then(e=>{f.appendChild(e),u.getAttribute("hidden")&&u.removeAttribute("hidden")}).catch(e=>{console.log(e)})}u.appendChild(f),i.appendChild(u);let E=document.createElement("div");E.classList.add("row");let C=crearCamposVisita(t);E.appendChild(C);let I=document.createElement("div");I.classList.add("col-6","d-flex","justify-content-end");let y=document.createElement("div");y.classList.add("d-flex","justify-content-start","row");let x=document.createElement("ul");x.classList.add("list-inline");let _=document.createElement("li");_.classList.add("list-inline-item","row","col-4");let A=document.createElement("strong");A.textContent="Horarios:",_.appendChild(A),x.appendChild(_);let S=e?.horario;if(void 0===S){let w=document.createElement("li");w.classList.add("list-inline-item","row");let B=document.createElement("div");B.classList.add("col-8"),B.textContent="Permanentemente abierto",w.appendChild(B),x.appendChild(w)}for(let k in S){let P=S[k].split("$"),M=document.createElement("li");M.classList.add("list-inline-item","row");let H=document.createElement("div");H.classList.add("col-2");let F=document.createElement("strong");F.textContent=P[0]+": ",H.appendChild(F),M.appendChild(H);let O=document.createElement("div");O.classList.add("col-10"),O.textContent=P[1],M.appendChild(O),x.appendChild(M)}y.appendChild(x),I.appendChild(y),E.appendChild(I),i.appendChild(E);let j=document.createElement("div");j.classList.add("button-group");let N=document.createElement("button");N.classList.add("btn","btn-primary","btn-xl","text-uppercase"),N.setAttribute("type","button"),N.setAttribute("id","botonAgregar"+t),N.setAttribute("data-bs-dismiss","modal"),N.textContent="A\xf1adir al plan",j.appendChild(N),isPlan()?N.onclick=function(){(null===sessionStorage.getItem("plan")||"[]"===sessionStorage.getItem("plan"))&&(document.getElementById("ol_espacioLista").innerHTML=""),savePopUpData(t,e.nombre),añadirElementoListaPlan(parseInt(sessionStorage.getItem("i"))-1,e.nombre,document.getElementById("hourIn"+t).value,document.getElementById("hourOut"+t).value)}:N.onclick=function(){savePopUpData(t,e.nombre),window.location.href="#",borrarIndex(),plan()};let T=e?.url;if(void 0!==T){let J=document.createElement("button");J.classList.add("btn","btn-secondary","btn-xl","text-uppercase"),J.setAttribute("type","button"),J.onclick=function(){window.open(T)},J.textContent="M\xe1s informaci\xf3n",j.appendChild(J)}return i.appendChild(j),i}function obtenerDatosClima(e,t,i,a){let l=`https://api.openweathermap.org/data/2.5/forecast?lat=${e}&lon=${t}&appid=1ff240de287dae93a6e61f1f4a04bf0a&units=metric`;return new Promise((e,t)=>{fetch(l).then(e=>e.json()).then(l=>{let n=l.list[a].weather[0].icon,d=l.list[a].main.temp;if(void 0===n||void 0===d){t("No hay datos sobre el clima disponibles a las"+i+" horas");return}let r=crearItemClima(i,d,n);if(void 0===r){t("No se han podido obtener el item");return}e(r)}).catch(e=>{console.error(e),t("Error al obtener los datos del clima")})})}function savePopUpData(e,t){let i={i:parseInt(sessionStorage.getItem("i")),name:t,hourIn:document.getElementById("hourIn"+e).value,hourOut:document.getElementById("hourOut"+e).value};sessionStorage.setItem("i",i.i+1);let a=sessionStorage.getItem("plan"),l;a?(l=JSON.parse(a)).push(i):l=[i],sessionStorage.setItem("plan",JSON.stringify(l))}function crearItemClima(e,t,i){t=Math.round(t);let a=document.createElement("div");a.classList.add("mx-3");let l=document.createElement("div");a.appendChild(l);let n=document.createElement("img");n.classList.add("img-weather"),n.setAttribute("src","https://openweathermap.org/img/wn/"+i+"@4x.png"),n.setAttribute("loading","lazy"),l.appendChild(n);let d=document.createElement("p");d.classList.add("item-intro","text-muted","mb-0"),e<10?d.textContent="0"+e+":00":d.textContent=e+":00",l.appendChild(d);let r=document.createElement("p");return r.classList.add("item-intro","text-muted","mb-0"),r.textContent=t+"\xb0C",l.appendChild(r),a}function crearCamposVisita(e){let t=document.createElement("div");t.classList.add("col-6","d-flex","justify-content-start","align-items-center");let i=document.createElement("div");i.classList.add("hour-list");let a=document.createElement("div");a.classList.add("row","mb-4","d-flex","hour-group");let l=document.createElement("div");l.classList.add("d-flex","justify-content-start","align-items-center");let n=document.createElement("strong");n.textContent="Hora de Entrada:",l.appendChild(n);let d=document.createElement("div");d.classList.add("d-flex","justify-content-start","align-items-center");let r=document.createElement("input");r.classList.add("form-control-sm"),r.setAttribute("id","hourIn"+e),r.setAttribute("type","time"),r.setAttribute("placeholder","10:00"),r.setAttribute("data-sb-validations","required"),d.appendChild(r),a.appendChild(l),a.appendChild(d),i.appendChild(a);let o=document.createElement("div");o.classList.add("row","d-flex","hour-group");let s=document.createElement("div");s.classList.add("d-flex","justify-content-start","align-items-center");let c=document.createElement("strong");c.textContent="Hora de Salida:",s.appendChild(c);let m=document.createElement("div");m.classList.add("d-flex","justify-content-start","align-items-center");let p=document.createElement("input");return p.classList.add("form-control-sm"),p.setAttribute("id","hourOut"+e),p.setAttribute("type","time"),p.setAttribute("placeholder","11:30"),p.setAttribute("data-sb-validations","required"),m.appendChild(p),o.appendChild(s),o.appendChild(m),i.appendChild(o),t.appendChild(i),t}function goHome(){if(null===document.getElementById("slider")){borrarPlan();document.getElementById("header").classList.add("masthead"),inicio()}}function crearSlider(){let e=document.getElementById("header");e.classList.add("masthead");let t=document.createElement("div");t.classList.add("slider"),t.setAttribute("id","slider"),e.appendChild(t);let i=document.createElement("div");i.classList.add("swiper-wrapper"),t.appendChild(i);let a=1;for(;a<=3;){let l=document.createElement("img"),n="assets/img/slider/imagen"+a+".webp";l.setAttribute("src",n),l.setAttribute("alt","Imagen slider "+a);let d=document.createElement("div");d.classList.add("swiper-slide"),d.appendChild(l),i.appendChild(d),a++}let r=document.createElement("div");r.classList.add("container","containerSlider"),t.appendChild(r);let o=document.createElement("div");o.classList.add("masthead-subheading"),o.textContent="Dise\xf1a una ruta pensada \xfanicamente para ti",r.appendChild(o);let s=document.createElement("div");s.classList.add("masthead-heading","text-uppercase"),s.textContent="!Atr\xe9vete a conocer Mallorca!",r.appendChild(s);let c=document.createElement("a");c.classList.add("btn","btn-primary","btn-xl","text-uppercase"),c.textContent="Planificar Ruta",c.onclick=function(){window.location.href="#",borrarIndex(),plan()},r.appendChild(c)}function borrarIndex(){setNavPorfolioHidden(!0),borrarSlider();document.getElementById("portfolioContainer").innerHTML="";let e=document.getElementById("main"),t=document.getElementById("team");t&&e.removeChild(t);document.getElementById("portfolio-modals").innerHTML=""}function borrarPlan(){document.getElementById("portfolioContainer").innerHTML="";document.getElementById("portfolio-modals").innerHTML=""}function borrarSlider(){let e=document.getElementById("header"),t=document.getElementById("slider");t&&e.removeChild(t),e.classList.remove("masthead")}function isPlan(){return null!=document.getElementById("ol_espacioLista")}function plan(){let e=document.getElementById("portfolioContainer"),t=document.createElement("div");t.classList.add("text-center","pt-5","pb-2");let i=document.createElement("h2");i.classList.add("section-heading","text-uppercase","mb-2"),i.textContent="Construye tu ruta";let a=document.createElement("h3");a.classList.add("section-subheading","text-muted","mb-3"),a.textContent="\xa1Organiza tu visita y no te quedes sin ver nada!",t.appendChild(i),t.appendChild(a),e.appendChild(t);let l=crearCamposBusqueda();e.appendChild(l);let n=document.createElement("div");n.setAttribute("id","busqueda-container");document.getElementById("barra").appendChild(n),añadirEventosBusqueda(),calendario(),autocompletar();let d=document.createElement("div");d.classList.add("row"),e.appendChild(d);let r=crearMapa();d.appendChild(r),initMapa(),busquedaBoton();let o=crearLista();d.appendChild(o);let s=sessionStorage.getItem("plan");if(s){let c=JSON.parse(s);for(let m=0;m<c.length;m++)añadirElementoListaPlan(c[m].i,c[m].name,c[m].hourIn,c[m].hourOut)}}function crearCamposBusqueda(){let e=document.createElement("div");e.classList.add("container","d-flex","align-items-center","mb-3"),e.setAttribute("id","busqueda");let t=document.createElement("div");t.classList.add("d-block"),e.appendChild(t);let i=document.createElement("button");i.classList.add("btn","btn-primary","me-4"),i.setAttribute("id","calendar-button"),i.textContent="Elegir d\xeda",t.appendChild(i);let a=document.createElement("svg");a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("viewBox","0 0 24 24"),a.setAttribute("width","24"),a.setAttribute("height","24"),a.setAttribute("fill","currentColor");let l=document.createElement("path");l.setAttribute("d","M6.75 0a.75.75 0 0 1 .75.75V3h9V.75a.75.75 0 0 1 1.5 0V3h2.75c.966 0 1.75.784 1.75 1.75v16a1.75 1.75 0 0 1-1.75 1.75H3.25a1.75 1.75 0 0 1-1.75-1.75v-16C1.5 3.784 2.284 3 3.25 3H6V.75A.75.75 0 0 1 6.75 0ZM21 9.5H3v11.25c0 .138.112.25.25.25h17.5a.25.25 0 0 0 .25-.25Zm-17.75-5a.25.25 0 0 0-.25.25V8h18V4.75a.25.25 0 0 0-.25-.25Z"),a.appendChild(l),i.appendChild(a);let n=document.createElement("div");n.setAttribute("type","button"),n.setAttribute("id","calendar-container"),t.appendChild(n);let d=`
        <div class="input-group mb-3">
            <!-- Filtros -->
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle me-2" data-bs-toggle="dropdown">Filtros</button>
                <form class="dropdown-menu" id="filtros-busqueda">
                    <div class="dropdown-item filtro d-flex">
                        <div class="col-6 d-flex justify-content-start align-items-center me-2">
                            <label>Hora de Inicio:</label>
                        </div>
                        <div class="col-6 d-flex justify-content-start">
                            <input class="form-control-sm" id="SearchHourStart" type="text" placeholder="10:00" data-sb-validations="required" />
                        </div>
                    </div>
                    <div class="dropdown-item filtro d-flex">
                        <div class="col-6 d-flex justify-content-start align-items-center me-2">
                            <label>Hora de Fin:</label>
                        </div>
                        <div class="col-6 d-flex justify-content-start">
                            <input class="form-control-sm"  id="SearchHourEnd" type="text" placeholder="11:30" data-sb-validations="required" />
                        </div>
                    </div>
                    <div class="dropdown-item filtro d-flex">
                        <div class="col-6 d-flex justify-content-start align-items-center me-2">
                            <label>Distancia m\xe1xima (km):</label>
                        </div>
                        <div class="col-6 d-flex justify-content-start">
                            <input class="form-control-sm"  id="SearchRadius" type="text" placeholder="10" data-sb-validations="required" />
                        </div>
                    </div>
                    <div class="dropdown-item filtro d-flex">
                        <div class="col-6 d-flex justify-content-start align-items-center me-2">
                            <label>Actividad gratuita:</label>
                        </div>
                        <div class="col-6 d-flex justify-content-start align-items-center">
                            <input class="form-check-input" type="checkbox" id="SearchFree">
                        </div>
                    </div>
                    <div class="dropdown-item filtro d-flex">
                        <div class="col-6 d-flex justify-content-start align-items-center me-2">
                            <label>Parking cercano:</label>
                        </div>
                        <div class="col-6 d-flex justify-content-start align-items-center">
                            <input class="form-check-input" type="checkbox" id="ParkingNear">
                        </div>
                    </div>
                    <div class="dropdown-item d-flex justify-content-center">
                        <button class="btn btn-light" id="botonFiltros">Aplicar Filtros</button>
                    </div>
                </form>
            </div>
            <!-- Barra de b\xfasqueda -->
            <input type="text" class="form-control" id="barra" placeholder="Buscar..." aria-label="Buscar" aria-describedby="SearchButton">
            <button class="btn btn-primary" type="submit" id="SearchButton">
                <i class="fas fa-search"></i>
            </button>
        </div>
        `;return e.innerHTML+=d,e}function buscar(e){if(!estaEnJson(e)){alert("No se ha encontrado ning\xfan edificio con ese nombre");return}sessionStorage.setItem("mapSelectedPlace",e),swapSelectedPlace(),resetMapa();document.getElementById("mapSelectedPlace").scrollIntoView({behavior:"smooth",block:"center"})}function busquedaBoton(){document.getElementById("SearchButton").onclick=function(){buscar(document.getElementById("barra").value)}}function mostrarResultados(e){let t=document.createElement("div");t.classList.add("container","d-flex","flex-column","align-items-center","mb-3"),t.setAttribute("id","searchResults");for(let i=0;i<e.length;i++){if(!checkCondicionesFiltros(e[i]))continue;let a=document.createElement("div");a.classList.add("d-flex","justify-content-center","align-items-center","mb-2"),a.setAttribute("id","resultado"+i),a.textContent=e[i].nombre,t.appendChild(a)}return t}function estaEnJson(e){for(let t=0;t<edificiosJSON.length;t++)if(edificiosJSON[t].nombre===e)return!0;return!1}function buscarEnJson(){let e=new Set;return edificiosJSON.forEach(t=>e.add(t.nombre)),[...e]}function autocompletar(){$(document.getElementById("barra")).autocomplete({source:buscarEnJson(),open:function(){$(".ui-autocomplete").addClass("search-z-index")}})}function calendario(){let e=!1,t=$("#calendar-container");if(0===t.length){console.error("No se ha encontrado el contenedor del calendario");return}t.hide(),t.datepicker({minDate:0,dateFormat:"yy-mm-dd",onSelect:function(i){if(confirm("\xbfQuieres cambiar la fecha del plan?\n\nFecha actual: "+sessionStorage.getItem("date"))){sessionStorage.setItem("date",i);document.getElementById("diaLista").textContent="D\xeda "+i;null!==document.getElementById("portfolioModal0")&&swapSelectedPlace(),t.hide(),e=!1}else t.datepicker("setDate",sessionStorage.getItem("date"))}});$("#calendar-button").click(function(){e?(t.hide(),e=!1):(t.show(),e=!0)}),$(document).mouseup(function(e){let t=$("#calendar-container");t.is(e.target)||0!==t.has(e.target).length||t.hide()})}function añadirEventosBusqueda(){let e=document.getElementById("SearchHourStart"),t=document.getElementById("SearchHourEnd"),i=document.getElementById("SearchFree"),a=document.getElementById("ParkingNear"),l=document.getElementById("botonFiltros"),n=document.getElementById("SearchRadius");l.onclick=function(l){l.preventDefault(),sessionStorage.setItem("hourInFiltros",""),sessionStorage.setItem("hourOutFiltros",""),""!==n.value?sessionStorage.setItem("distanciaFiltros",n.value):sessionStorage.setItem("distanciaFiltros","0"),checkHorasFiltros(e.value,t.value),sessionStorage.setItem("searchFree",""+i.checked),sessionStorage.setItem("parkingNear",""+a.checked),resetMapa()},sessionStorage.setItem("hourInFiltros",""),sessionStorage.setItem("hourOutFiltros",""),sessionStorage.setItem("distanciaFiltros","0"),sessionStorage.setItem("searchFree","false"),sessionStorage.setItem("parkingNear","false")}function checkHorasFiltros(e,t){if(esHora(e)&&esHora(t)){let i=e.split(":"),a=t.split(":"),l=parseInt(i[0]),n=parseInt(a[0]);if(l<n)sessionStorage.setItem("hourInFiltros",e),sessionStorage.setItem("hourOutFiltros",t);else if(l==n){let d=parseInt(i[1]),r=parseInt(a[1]);d<r&&(sessionStorage.setItem("hourInFiltros",e),sessionStorage.setItem("hourOutFiltros",t))}}}function esHora(e){try{let t=e.split(":");if(2===t.lenght){let i=parseInt(t[0]),a=parseInt(t[1]);return i>=0&&i<24&&a>=0&&a<=60}return!1}catch(l){return!1}}function crearMapa(){let e=document.createElement("div");e.classList.add("col-lg-8","col-sm-6","mb-4"),e.setAttribute("id","mapContainer");let t=document.createElement("div");t.classList.add("mb-2","d-flex","justify-content-center"),e.appendChild(t);let i=document.createElement("div");i.setAttribute("id","map"),i.setAttribute("style","width: 600px; height: 400px;"),t.appendChild(i);let a=`
        <!-- Selected From Map-->
        <div class="portfolio-item" id="mapSelectedPlace">
            <a class="portfolio-link" data-bs-toggle="modal" href="#portfolioModal0">
                <div id="popUpPortfolioHover" class="portfolio-hover" hidden="true">
                    <div class="portfolio-hover-content"><i class="fas fa-plus fa-3x"></i></div>
                </div>
                <img id="mapSelectedPlaceImg" class="img-fluid" src="" alt="Missing image..." hidden="true" loading="lazy"/>
            </a>
            <div class="portfolio-caption">
                <div class="portfolio-caption-heading" id="mapSelectedPlaceTitle">Busca tu destino</div>
                <div class="portfolio-caption-subheading text-muted" id="mapSelectedPlaceSubtitle">Puedes usar tanto la barra de b\xfasqueda como el mapa</div>
            </div>
        </div>
        `;return e.innerHTML+=a,e}function initMapa(){let e=parseFloat(sessionStorage.getItem("crd-latitude")),t=parseFloat(sessionStorage.getItem("crd-longitude"));map=L.map("map").setView([e,t],10.5),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);L.marker([39.59398458121737,2.678878006135083]).addTo(map).bindPopup("<b>Casa de Carlos</b><br>Dominio p\xfablico."),añadirMarcadoresMapa()}function añadirMarcadoresMapa(){"0"!==sessionStorage.getItem("distanciaFiltros")&&L.circle([parseFloat(sessionStorage.getItem("crd-latitude")),parseFloat(sessionStorage.getItem("crd-longitude"))],{color:"blue",fillColor:"#30f",fillOpacity:.1,radius:1e3*parseInt(sessionStorage.getItem("distanciaFiltros"))}).addTo(map);for(let e=0;e<edificiosJSON.length;e++){let t=edificiosJSON[e];void 0===t.lat||void 0===t.lon?console.error("El lugar "+t.nombre+" no tiene coordenadas"):checkCondicionesFiltros(t)&&L.marker([t.lat,t.lon]).addTo(map).on("click",function(){sessionStorage.setItem("mapSelectedPlace",t.nombre),swapSelectedPlace(),resetMapa();document.getElementById("mapSelectedPlace").scrollIntoView({behavior:"smooth",block:"center"})})}}function checkCondicionesFiltros(e){return("false"===sessionStorage.getItem("searchFree")||e?.isAccessibleForFree===!0)&&("false"===sessionStorage.getItem("parkingNear")||e?.parking===!0)&&("0"===sessionStorage.getItem("distanciaFiltros")||calcularDistancia(e.lat,e.lon)<=parseInt(sessionStorage.getItem("distanciaFiltros")))&&(""===sessionStorage.getItem("hourInFiltros")&&""===sessionStorage.getItem("hourOutFiltros")||checkHorario(e))}function checkHorario(e){let t=sessionStorage.getItem("hourInFiltros"),i=sessionStorage.getItem("hourOutFiltros"),a=e.horario,l=(new Date(sessionStorage.getItem("date")).getDay()-1)%7,n=!1,d=!1;for(let r=0;r<a.length;r++){let o=a[r].split("$"),s=parseInt(o[0]),c=o[1].split(" - "),m=c[0].split(":"),p=c[1].split(":");s===l&&((""==t||parseInt(m[0])<parseInt(t)&&parseInt(m[0])<parseInt(i))&&(n=!0),(""==i||parseInt(p[0])>parseInt(t)&&parseInt(p[0])>parseInt(i))&&(d=!0))}return n&&d}function calcularDistancia(e,t){let i=parseFloat(sessionStorage.getItem("crd-latitude")),a=parseFloat(sessionStorage.getItem("crd-longitude")),l=e,n=(l-i)*Math.PI/180,d=(t-a)*Math.PI/180,r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(i*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(d/2)*Math.sin(d/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function resetMapa(){borrarMarkers(),añadirMarcadoresMapa()}function borrarMarkers(){let e=document.querySelector(".leaflet-marker-pane"),t=document.querySelector(".leaflet-shadow-pane"),i=document.querySelector(".leaflet-popup-pane");e.innerHTML="",t.innerHTML="",i.innerHTML="";let a=document.querySelector(".leaflet-overlay-pane");a&&a.querySelectorAll("path").forEach(function(e){e.remove()})}function getUserPosition(){navigator.geolocation.getCurrentPosition(function e(t){let i=t.coords;sessionStorage.setItem("crd-latitude",""+i.latitude),sessionStorage.setItem("crd-longitude",""+i.longitude)},function e(){console.error("No se ha podido obtener la ubicaci\xf3n del usuario"),sessionStorage.setItem("crd-latitude","39.59398458121737"),sessionStorage.setItem("crd-longitude","2.678878006135083")},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}function swapSelectedPlace(){let e=document.getElementById("popUpPortfolioHover");e.getAttribute("hidden")&&e.removeAttribute("hidden");let t=document.getElementById("mapSelectedPlaceTitle"),i=document.getElementById("mapSelectedPlaceSubtitle"),a=document.getElementById("mapSelectedPlaceImg");a.getAttribute("hidden")&&a.removeAttribute("hidden");let l=document.getElementById("portfolio-modals");l.innerHTML="";let n=sessionStorage.getItem("mapSelectedPlace"),d=obtenerEdificioJSON(n);t.innerText=n,d?.subtitulo===void 0?i.innerText="":i.innerText=d?.subtitulo,a.setAttribute("src",d.imagen),map.setView([d.lat,d.lon],15),generarPopUp(l,d,0);let r=document.getElementById("hourIn0"),o=document.getElementById("hourOut0");function s(){let e=document.getElementById("botonAgregar0"),t=document.getElementById("hourIn0"),i=document.getElementById("hourOut0");t.value&&i.value&&t.value<i.value?e.disabled=!1:e.disabled=!0}r.addEventListener("change",function(){s()}),o.addEventListener("change",function(){s()}),s()}function obtenerEdificioJSON(e){let t=0;for(;t<edificiosJSON.length-1&&edificiosJSON[t].nombre!==e;)t++;return edificiosJSON[t]}function crearLista(){let e=document.createElement("div");e.classList.add("col-lg-4","col-sm-6","mb-4");let t=document.createElement("div");t.classList.add("d-flex","justify-content-center"),e.appendChild(t);let i=document.createElement("h3");i.classList.add("section-heading","text-uppercase"),i.setAttribute("id","diaLista"),i.textContent="D\xeda "+sessionStorage.getItem("date"),t.appendChild(i);let a=document.createElement("ol");if(a.classList.add("espacioLista","list-group"),a.setAttribute("id","ol_espacioLista"),null===sessionStorage.getItem("plan")||"[]"===sessionStorage.getItem("plan")){let l=document.createElement("div");l.classList.add("text-center","text-muted","mt-3","me-3","ms-3","fs-5"),l.setAttribute("id","aventura"),l.textContent="Aqu\xed se mostrar\xe1n los destinos de tu pr\xf3xima aventura...",a.appendChild(l)}return e.appendChild(a),e}function añadirElementoListaPlan(e,t,i,a){let l=document.getElementById("ol_espacioLista"),n=document.createElement("li");n.classList.add("list-group-item"),n.setAttribute("id","li_espacioLista"+e);let d;d=""!=i&&""!=a?i+" - "+a+":":"N/A",void 0===t?t="N/A":(n.onclick=function(){window.location.href="#portfolioModal0"},n.style.cursor="pointer");let r=`
        <div class="col-8"> 
            <strong> ${d} </strong> ${t}
        </div>
        `;n.innerHTML+=r;let o=document.createElement("div");o.classList.add("col-4","d-flex","justify-content-end");let s=document.createElement("button");s.classList.add("btn","btn-secondary"),s.innerHTML+='<i class="fa-solid fa-trash"></i>',s.onclick=function(){eliminarElementoListaPlan(e)},o.appendChild(s),n.appendChild(o),l.appendChild(n),n.onclick=function(){buscar(t)}}function eliminarElementoListaPlan(e){let t=document.getElementById("ol_espacioLista"),i=document.getElementById("li_espacioLista"+e);t.removeChild(i);let a=sessionStorage.getItem("plan");if(a){let l=JSON.parse(a),n=0;for(;n<l.length&&l[n].i!=e;)n++;n<l.length&&l.splice(n,1),sessionStorage.setItem("plan",JSON.stringify(l))}}function scriptSlider(){new Swiper(".slider",{loop:!0,speed:2e3,autoplay:{delay:5e3,disableOnInteraction:!1},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},keyboard:!0})}